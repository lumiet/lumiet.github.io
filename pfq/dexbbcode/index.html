<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <title>bbcode</title>
  <style>
  body { font-family:Verdana;}
  svg { display:none;}
  h3 {margin:0;}
  </style>
  </head>
  
 <body><form name="uploadForm">
    <input type="file" id="fileinput"/><br>
</form>
<form name="generate">
<h3>Options</h3>
<select id="typeselect">
<option value="m_egg">Missing Eggdex</option>
<option value="m_pkmn">Missing Pokedex</option>
<option value="m_shiny">Missing Shiny</option>
<option value="m_albino">Missing Albino</option>
<option value="m_melan">Missing Melan</option>
<option value="h_egg">Obtained Eggdex</option>
<option value="h_pkmn">Obtained Pokedex</option>
<option value="h_shiny">Obtained Shiny</option>
<option value="h_albino">Obtained Albino</option>
<option value="h_melan">Obtained Melan</option>
</select>
<br>
<h3>Region</h3>
<select id="regionselect">
<option value=0>Kanto</option>
<option value=1>Johto</option>
<option value=2>Hoenn</option>
<option value=3>Sinnoh</option>
<option value=4>Unova</option>
<option value=5>Kalos</option>
<option value=6>Alola</option>
<option value=7>Galar</option>
<option value=8>Paldea</option>
<option value=9>PFQ Exclusives</option>
<option value=10>PFQ Megas</option>
<option value=11>PFQ Variants</option>
</select>
<br>
<h3>Type</h3>
<input type="radio" id="sel_bbcode" name="type" value="bbcode" checked>
<label for="sel_bbcode">BBCode</label><br>
<input type="radio" id="sel_text" name="type" value="text">
<label for="sel_text">Text-only</label><br>
</input>
<button type='button' onclick="gen()">Generate</button>
</form>
<h3>Output</h3>
<textarea id="output" style="width:300px;height:150px;">N/A</textarea>
	<script>
	//this entire thing will probably break horrifically if the html page is changed in any significant way, but i'm not gonna think about that <3
	
	
	document.getElementById('fileinput').value = null; // clear file input on reload
	
	document.getElementById('fileinput').addEventListener("change", readFile, false);
	document.getElementById('output').value = "N/A";
function gen() {
		const option = document.getElementById("typeselect").value;
		const region = document.getElementById("regionselect").value;
		const type = document.querySelector('input[name="type"]:checked').value;
		const output = document.getElementById("output");
		const list = window.regionList[region].pkmnlist;
		var filteredList = [];
		
		if(type=="bbcode") {
		
		}
		else { //text
			for(var i = 0; i<list.length; i++) {
				pkmn = list[i];
				if(option=="m_egg" && pkmn.egg==false) filteredList.push(" " + pkmn.name); 
				else if(option=="h_egg" && pkmn.egg==true) filteredList.push(" " + pkmn.name);
				else if(option=="m_pkmn" && pkmn.pkmn==false) filteredList.push(" " + pkmn.name); 
				else if(option=="h_pkmn" && pkmn.pkmn==true) filteredList.push(" " + pkmn.name);  
				else if(option=="m_shiny" && pkmn.shiny==false) filteredList.push(" " + pkmn.name); 
				else if(option=="h_shiny" && pkmn.shiny==true) filteredList.push(" " + pkmn.name); 
				else if(option=="m_albino" && pkmn.albino==false) filteredList.push(" " + pkmn.name); 
				else if(option=="h_albino" && pkmn.albino==true) filteredList.push(" " + pkmn.name); 
				else if(option=="m_melan" && pkmn.melan==false) filteredList.push(" " + pkmn.name); 
				else if(option=="h_melan" && pkmn.melan==true) filteredList.push(" " + pkmn.name); 
				
			}
			if(filteredList.length == 0) {
				output.value = "No entries";
				return;
			}
			filteredList[0] = filteredList[0].replace(" ", ''); //just getting rid of leading space
			output.value = filteredList; 
			
		}
	}
	

	
function readFile(){
    const contents=document.getElementById('contents');
    //Gets files from document element
    const files=document.getElementById('fileinput').files;
    //Selects first File and assigns it to file
    const file=files[0];
    //creates file reader
    const reader = new FileReader();
    //tells the file reader what to do after loading file
    reader.onload=function(e){
        //Prints contents of first file to the console
		const page = e.target.result;
        //console.log(e.target.result);
		const parser = new DOMParser();
		const htmlDoc = parser.parseFromString(page, 'text/html');

		//make sure they're actually on pokedex page...
		console.log(htmlDoc.title);
		console.log(htmlDoc.title.includes("Pokédex - PokéFarm Q"));
		if(!htmlDoc.title.includes("Pokédex - PokéFarm Q")) {
		window.alert("Incorrect HTML page used, please re-read instructions");
		return;
		}
		
		//window.htmlDoc = htmlDoc;
		//console.log(htmlDoc.getElementsByTagName('a'));
		//contents.innerHTML = htmlDoc.body.innerHTML;
		//KANTO - 1
		const kantohtml = parser.parseFromString(htmlDoc.getElementById("region-1").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const kanto = new region(kantohtml,"Kanto");
		kanto.initlist();
		//JOHTO - 2
		const johtohtml = parser.parseFromString(htmlDoc.getElementById("region-2").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const johto = new region(johtohtml,"Johto");
		johto.initlist();
		//HOENN - 3
		const hoennhtml = parser.parseFromString(htmlDoc.getElementById("region-3").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const hoenn = new region(hoennhtml,"Hoenn");
		hoenn.initlist();
		//SINNOH - 4
		const sinnohhtml = parser.parseFromString(htmlDoc.getElementById("region-4").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const sinnoh = new region(sinnohhtml,"Sinnoh");
		sinnoh.initlist();
		//UNOVA - 5
		const unovahtml = parser.parseFromString(htmlDoc.getElementById("region-5").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const unova = new region(unovahtml,"Unova");
		unova.initlist();
		//KALOS - 6
		const kaloshtml = parser.parseFromString(htmlDoc.getElementById("region-6").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const kalos = new region(kaloshtml,"Kalos");
		kalos.initlist();
		//ALOLA - 7
		const alolahtml = parser.parseFromString(htmlDoc.getElementById("region-7").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const alola = new region(alolahtml,"Alola");
		alola.initlist();
		//GALAR - 8
		const galarhtml = parser.parseFromString(htmlDoc.getElementById("region-8").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const galar = new region(galarhtml,"Galar");
		galar.initlist();
		//PALDEA - 9
		const paldeahtml = parser.parseFromString(htmlDoc.getElementById("region-9").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const paldea = new region(paldeahtml,"Paldea");
		paldea.initlist();
		//POKEFARM Q (EXCLUSIVES) - 97
		const exclusiveshtml = parser.parseFromString(htmlDoc.getElementById("region-97").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const exclusives = new region(exclusiveshtml,"PokéFarm Q (Exclusives)");
		exclusives.initlist();
		//POKEFARM Q (MEGAS) - 98
		const megashtml = parser.parseFromString(htmlDoc.getElementById("region-98").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const megas = new region(megashtml,"PokéFarm Q (Megas)");
		megas.initlist();
		//POKEFARM Q (VARIANTS) - 99
		const variantshtml = parser.parseFromString(htmlDoc.getElementById("region-99").getElementsByClassName("region-entries")[0].outerHTML, 'text/html');
		const variants = new region(variantshtml,"PokéFarm Q (Variants)");
		variants.initlist();
		//console.log(kanto.html.body);
        //contents.innerHTML= page.children[3];
		//contents.innerHTML = kanto.html.body.innerHTML;
		//var bbcodeStr = "";
		window.regionList = [kanto,johto,hoenn,sinnoh,unova,kalos,alola,galar,paldea,exclusives,megas,variants];
		/*for(var i = 0; i < regionList.length; i++) {
		var bbcodeStr = "";
			for(var j=0; j<regionList[i].pkmnlist.length; j++) {
				bbcodeStr += regionList[i].pkmnlist[j].bbcode;
			}
			console.log(bbcodeStr);
		}
		*/
		
    }
    //will read and then perform onload
    reader.readAsText(file, "UTF-8");
    //Prevents page from refreshing
    return false;
}
	//OBJECT CLASSES
	function region(html, name) {
	this.html = html;
	this.name = name;
	this.pkmnlist = [];
	this.initlist = function() {	
	var ol = this.html.body.children[0];
	var pkmnlength = ol.children.length;
	//is length - 1 because the last child is a node to jump to the top, not a pokemon
	for(var i = 0; i<pkmnlength-1; i++) {
		//console.log(ol.children[i]);
		var foundName = ol.children[i].getElementsByClassName("name")[0].textContent;
		var hasEgg = ol.children[i].classList.contains("egg-complete");
		var hasPkmn = ol.children[i].classList.contains("pkmn-complete");
		var hasShiny = ol.children[i].classList.contains("shiny-complete");
		var hasAlbino = ol.children[i].classList.contains("albino-complete");
		var hasMelan = ol.children[i].classList.contains("melan-complete");
		//bbcode: array with 0 = normal, 1 = shiny, 2 = albino, 3 = melan
		var bbcode = ["[pkmn=" + foundName + "]","[pkmn=" + foundName + "(S)]","[pkmn=" + foundName + "(A)]","[pkmn=" + foundName + "(M)]"];
		//variants and exclusives need bbcode format [pkmn=name/]
		if(this.name == "PokéFarm Q (Variants)" || this.name == "PokéFarm Q (Exclusives)") bbcode = ["[pkmn=" + foundName + "/]", "[pkmn=" + foundName + "(S)/]","[pkmn=" + foundName + "(A)/]","[pkmn=" + foundName + "(M)/]"];
		//megas or other formes need bbcode format [pkmn=name/forme]
		//foundName format name[forme]
		if(foundName.includes("[")) {
			temp = "[pkmn=" + (foundName.replace('[','/').replace(']','') + "]");
			bbcode = [temp,temp.replace(/\//g, "(S)/"),temp.replace(/\//g, "(A)/"),temp.replace(/\//g, "(M)/")];
			}
		this.pkmnlist.push(new pkmn(foundName,hasEgg,hasPkmn,hasShiny,hasAlbino,hasMelan, bbcode));
	}
	//console.log(this.pkmnlist);
		}
	}
	
	function pkmn(name, egg, pkmn, shiny, albino, melan, bbcode) {
	this.name = name;
	this.egg = egg;
	this.pkmn = pkmn;
	this.shiny = shiny;
	this.albino = albino;
	this.melan = melan;
	this.bbcode = bbcode;
	}
	</script></body>